
// nested pipelines test

algorithm main(output uint8 leds)
{

  uint5 i = 0;
  while (i!=5)
  {

      // stage 0
      uint5 n = i;
      __display("[A]        (%d)",n);
      i = i + 1;

    ->

      __display("[B] before (%d)",n);
      // stage 1
      uint5 j    = 0;
      uint1 done = 0;
      while (~done) {
          // nested pipeline
          __display("[B,A] %d,%d",n,j);
          uint8 q = j + 10;
          j       = j + 1;
        ->
          __display("[B,B] %d,%d",n,q);
          q = q + 100;
        ->
          __display("[B,C] %d,%d",n,q);
          if (j == 3) { done = 1; }
      }
    ++: ////////////////////////////// breaks without, why?
      __display("[B] after (%d)",n);

    ->

      __display("[C]       (%d)",n);

  }

}
